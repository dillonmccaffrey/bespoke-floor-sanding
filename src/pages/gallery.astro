---
import Layout from '../layouts/Layout.astro';
import { getGallery, getGeneralSettings, formatPhoneHref } from '../lib/content';

const settings = getGeneralSettings();
const phoneHref = formatPhoneHref(settings.phone);
const allProjects = getGallery();

const categories = [
  { slug: 'all', label: 'All Projects', description: 'View all our completed floor sanding projects across Ireland.' },
  { slug: 'residential', label: 'Residential', description: 'Beautiful floor transformations in homes across Dublin, Monaghan, Cavan, and Meath.' },
  { slug: 'commercial', label: 'Commercial', description: 'Professional floor sanding for offices, schools, and commercial spaces.' },
];

const projectsByCategory: Record<string, typeof allProjects> = {
  all: allProjects,
};

categories.forEach(cat => {
  if (cat.slug !== 'all') {
    projectsByCategory[cat.slug] = allProjects.filter(item => item.category === cat.slug);
  }
});
---

<Layout title="Gallery" description="View before and after photos of our floor sanding projects. Bespoke Floor Sanding Co. transforms wooden floors across Dublin, Monaghan, Cavan, and Midlands Ireland.">
  <!-- Hero -->
  <section class="py-16 bg-gradient-to-b from-background to-background-light">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-4xl sm:text-5xl font-bold text-text mb-6">Our Work</h1>
      <p class="text-lg text-text-muted max-w-2xl mx-auto">
        See the transformations we've achieved for clients across Ireland.
      </p>
    </div>
  </section>

  <section class="py-16 bg-background-light">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Category Tabs -->
      <div class="mb-8">
        <nav class="flex flex-wrap justify-center gap-2" aria-label="Gallery categories">
          {categories.map((cat, index) => (
            <button
              type="button"
              class={`gallery-tab px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${index === 0 ? 'bg-primary text-background border-primary' : 'border-background-lighter text-text-muted hover:border-primary hover:text-primary'}`}
              data-category={cat.slug}
            >
              {cat.label}
              {cat.slug !== 'all' && projectsByCategory[cat.slug]?.length > 0 && (
                <span class="ml-1 text-xs opacity-60">({projectsByCategory[cat.slug].length})</span>
              )}
            </button>
          ))}
        </nav>
      </div>

      <p id="category-description" class="text-center text-text-muted mb-8 max-w-2xl mx-auto">
        {categories[0].description}
      </p>

      <!-- Gallery Panels -->
      {categories.map((cat, index) => (
        <div
          class="gallery-panel"
          data-panel={cat.slug}
          data-description={cat.description}
          style={index !== 0 ? 'display: none;' : ''}
        >
          {projectsByCategory[cat.slug]?.length > 0 ? (
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
              {projectsByCategory[cat.slug].map((project) => (
                <div class="group bg-background rounded-xl overflow-hidden border border-background-lighter hover:border-primary/30 transition-all">
                  <div class="relative aspect-[4/3] bg-background-lighter overflow-hidden">
                    {project.beforeImage && project.afterImage ? (
                      <div class="absolute inset-0 flex">
                        <div class="w-1/2 relative overflow-hidden">
                          <img src={project.beforeImage} alt="Before" class="absolute inset-0 w-full h-full object-cover" loading="lazy" />
                          <span class="absolute bottom-2 left-2 bg-background/80 text-text text-xs px-2 py-1 rounded">Before</span>
                        </div>
                        <div class="w-1/2 relative overflow-hidden border-l-2 border-primary">
                          <img src={project.afterImage} alt="After" class="absolute inset-0 w-full h-full object-cover" loading="lazy" />
                          <span class="absolute bottom-2 right-2 bg-primary text-background text-xs px-2 py-1 rounded">After</span>
                        </div>
                      </div>
                    ) : (
                      <div class="absolute inset-0 bg-gradient-to-r from-background-lighter to-background-light flex items-center justify-center">
                        <p class="text-text-muted text-sm">Before / After</p>
                      </div>
                    )}
                  </div>
                  <div class="p-5">
                    <div class="flex items-center gap-2 text-primary text-sm mb-2">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                      </svg>
                      <span>{project.location}</span>
                    </div>
                    <h3 class="text-lg font-semibold text-text mb-1">{project.title}</h3>
                    <p class="text-text-muted text-sm">{project.description}</p>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div class="text-center py-16 bg-background rounded-xl border border-background-lighter">
              <svg class="w-16 h-16 mx-auto mb-4 text-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              <p class="text-text-muted">No projects in this category yet.</p>
              <p class="text-text-muted text-sm mt-2">Check back soon for updates!</p>
            </div>
          )}
        </div>
      ))}

      <!-- CTA -->
      <div class="mt-16 bg-primary rounded-xl p-8 lg:p-12 text-center">
        <h2 class="text-2xl lg:text-3xl font-bold text-background mb-4">
          Like What You See?
        </h2>
        <p class="text-background/80 mb-6 max-w-2xl mx-auto">
          Get in touch for a free, no-obligation quote. We'd love to add your floor to our gallery.
        </p>
        <a
          href={phoneHref}
          class="inline-flex items-center gap-2 bg-background hover:bg-background-light text-text font-semibold px-8 py-4 rounded-lg transition-colors duration-200"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" />
          </svg>
          Call for Free Quote
        </a>
      </div>
    </div>
  </section>
</Layout>

<script>
  const categoryDescriptions: Record<string, string> = {
    'all': 'View all our completed floor sanding projects across Ireland.',
    'residential': 'Beautiful floor transformations in homes across Dublin, Monaghan, Cavan, and Meath.',
    'commercial': 'Professional floor sanding for offices, schools, and commercial spaces.',
  };

  function initGalleryTabs() {
    const tabs = document.querySelectorAll('.gallery-tab');
    const panels = document.querySelectorAll('.gallery-panel');
    const descriptionEl = document.getElementById('category-description');

    function setActiveTab(category: string) {
      tabs.forEach(tab => {
        const isActive = tab.getAttribute('data-category') === category;
        tab.classList.toggle('bg-primary', isActive);
        tab.classList.toggle('text-background', isActive);
        tab.classList.toggle('border-primary', isActive);
        tab.classList.toggle('text-text-muted', !isActive);
        tab.classList.toggle('border-background-lighter', !isActive);
      });

      panels.forEach(panel => {
        const isActive = panel.getAttribute('data-panel') === category;
        (panel as HTMLElement).style.display = isActive ? '' : 'none';
      });

      if (descriptionEl && categoryDescriptions[category]) {
        descriptionEl.textContent = categoryDescriptions[category];
      }

      history.replaceState(null, '', category === 'all' ? '/gallery' : `/gallery#${category}`);
    }

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const category = tab.getAttribute('data-category') || 'all';
        setActiveTab(category);
      });
    });

    const hash = window.location.hash.slice(1);
    const validCategories = ['all', 'residential', 'commercial'];
    const initialCategory = validCategories.includes(hash) ? hash : 'all';
    setActiveTab(initialCategory);
  }

  initGalleryTabs();
  document.addEventListener('astro:page-load', initGalleryTabs);
</script>
